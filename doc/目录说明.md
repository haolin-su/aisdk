# AISDK 目录说明

## 目录结构

最上层目录结构如下：

```
aisdk/
.
|-- CHANGELOG.md        // 版本变更说明
|-- CMakeLists.txt      // 顶层CMakeLists.txt
|-- README.md           // 项目说明
|-- VERSION             // 版本号
|-- cmake               // 编译相关文件
|-- doc                 // 文档目录 
|-- docker              // docker相关文件
|-- include             // 头文件目录
|-- java                // java相关文件
|-- python              // python相关文件
|-- release             // 发布相关文件
|-- sample              // 示例目录
|-- src                 // 源代码目录
|-- test                // 测试目录
|-- third_party          // 第三方库目录
|-- toolchains          // 工具链目录
|-- tools               // 工具目录
```

说明：
本目录结构主要是站在C++工程的角度进行划分，java/python均是在C++基础上封装接口，单独一个文件夹写接口定义。而ai tools相关的大部分python代码放在tools目录下，后续可根据项目规模大小进行拆分为独立仓库。

## 子目录说明

### doc

文档目录，包含代码架构说明、设计文档、接口文档、使用文档等。

主要分以下部分：
- 通用文档直接放在doc目录下。
- 核心架构设计细节放在“架构设计”目录下，主要是核心层设计，注册新算法新设备流程，以及各个模块的接口定义等。
- 每个芯片厂商的资料文件或者笔记都需要放在对应名字的目录下，如：qualcomm/mtk等。需要包含的资料：环境搭建，安装包，版本说明，驱动说明，使用说明等。
- release相关文档放在“release”目录下，主要是各个版本的发布说明，版本变更说明等。


### include

头文件目录，包含项目的共用并且可对外暴露的头文件。
如：配置头文件，接口头文件等。

注意：每个芯片厂商SDK对接的头文件均需要放在对应的注册目录下，不可暴露在此文件夹对外。  
核心代码的头文件也不能放在此文件夹，应放在src目录下。

目前包含以下目录：
- api：接口定义目录
- error：错误码定义目录
- license：授权文件目录
- logger：日志目录
- pipeline：管道目录
- processor：处理器目录
- result：结果目录
- utils：工具目录



### src

源代码目录，包含项目的C++源代码。
主要包含以下目录：
```
|-- src
|   |-- CMakeLists.txt
|   |-- api
|   |-- app
|   |-- core
|   `-- registry
```

- api：包含项目的接口定义；
- app：包含项目的应用层代码；
- core：包含项目的核心代码。主要是包含基类定义，数据结构定义，推理引擎代码等；
- registry：包含项目的注册目录；

#### api

接口定义目录，包含项目的接口定义。
主要包含以下文件：
- config.h：项目的配置头文件。
- infer.h：推理接口定义。
- model.h：模型接口定义。
- memory.h：内存管理接口定义。
- utils.h：工具接口定义。


#### app

应用层代码目录，包含项目的应用层代码，可编译生成可执行文件。
主要包含以下文件：
cv：包含图像处理相关的应用层代码。
nlp：包含文本处理相关的应用层代码。
audio：包含音频处理相关的应用层代码。

以CV为例，需要实现视频结构化功能，包含视频解码，图像前处理，模型推理，后处理，图像编码等流程和功能；
包含以下文件：
main.cpp：项目的入口文件。
pipeline.cpp：项目的管道文件。
pipeline.h：项目的管道头文件。


#### registry
分为算法目录和芯片目录。
如下：
```
|-- src
|   `-- registry
|       |-- algorithm
|       |   |-- audio
|       |   |-- cv
|       |   `-- nlp
|       `-- devices
|           |-- mtk
|           `-- qualcomm
```

其中芯片厂商目录最低要求要实现的接口文件：
以高通为例：
- qualcomm_device.h：高通设备管理接口定义。
- media/qualcomm_video_decoder.h：高通视频解码接口定义。
- media/qualcomm_video_encoder.h：高通视频编码接口定义。
- media/qualcomm_pic_decoder.h：高通图片解码接口定义。
- media/qualcomm_pic_encoder.h：高通图片编码接口定义。

其中推理框架，以SNPE为例：
- snpe_model.h  // 模型载入和信息解析
- snpe_memory.h   // 内存管理
- snpe_infer.h    // 模型推理
- snpe_utils.h    // 工具接口
- snpe_preproc.h  // 算法前处理的硬件加速实现
- snpe_postproc.h // 算法后处理的硬件加速实现


算法目录：

算法目录下包含各个算法的注册文件，主要包含以下文件：
- algorithm.h：算法注册接口定义，主要包含cpu实现的算法的前处理和后处理；
- algorithm_info.h：算法信息接口定义。
- algorithm_impl.h：算法实现接口定义。
- algorithm_accuracy.h：算法精度接口定义。
- algorithm_performance.h：算法性能接口定义。
- algorithm_preproc.h：算法前处理接口定义。
- algorithm_postproc.h：算法后处理接口定义。


### test

测试目录

```
|-- test
|   |-- CMakeLists.txt
|   |-- unit    // 单元测试用例
|   |-- integration // 集成测试用例
|   |-- performance // 性能测试用例
|   `-- stress  // 压力测试用例
```


### sample

示例目录，包含项目的示例代码，将会release作为示例代码的发布包。
分为CV/NLP/Android等目录

```
|-- sample
|   |-- CV
|   |   |-- CMakeLists.txt
|   |   |-- README.md
|   |   `-- sample_cv   // 示例代码，包含分类/检测/分割等算法的示例代码
|   |-- NLP
|   |   |-- CMakeLists.txt
|   |   |-- README.md
|   |   `-- sample_nlp   // 示例代码，包含知识问答/翻译/文本摘要/RAG等算法的示例代码
|   |-- Android
|   |   |-- CMakeLists.txt
|   |   |-- README.md
|   |   `-- sample_android   // 示例代码，完整的android工程代码，包含Android平台的算法的示例代码
|   `-- README.md
```


### cmake

编译相关文件目录
每个芯片厂商使用的SDK所以来的头文件库文件均需要自定义一个单独的.cmake文件，放在此目录下。  
共用的模块放在common.cmake文件中。比如spdlog、json、gtest等。  

每个cmake文件夹中需区分不同平台的编译选项，目前主要是linux和android平台。

### tools

工具目录，包含项目的工具相关文件。
主要是fiboai_tools目录

```
|-- tools
|   `-- fiboai_tools
|       |-- README.md
|       |-- fiboai_tools
|       |   |-- __init__.py
|       |   |-- benchmark
|       |   |   `-- communication
|       |   |       `-- adb.py
|       |   |-- core
|       |   |   `-- pipeline.py
|       |   |-- infer
|       |   `-- modelconverter
|       `-- config
|           `-- snpe.json
```

### docker

docker相关文件目录，包含制作docker镜像文件相关的文件，比如每个芯片SDK的dockerfile文件，部分依赖的按照脚本和配置文件等。


### java

java相关文件目录，包含项目的java相关文件，比如JNI接口文件。


### python

python相关文件目录，包含项目的python相关文件，比如pybind11相关定义代码


### third_party

第三方库目录，比如高通的SDK包qcom文件，spdlog/opencv/ffmpeg等第三方库文件。


### toolchains

工具链目录，包含项目的工具链配置相关文档。
比如：linux平台的编译链、android平台的编译链等。


### release

发布相关文件目录，包含项目的发布相关文件，比如release的版本号、README.md、文档等。


## 附录

### 目前目录结构


```
.
|-- CHANGELOG.md
|-- CMakeLists.txt
|-- README.md
|-- VERSION
|-- cmake
|   |-- install.cmake
|   |-- qnn.cmake
|   `-- snpe.cmake
|-- doc
|-- docker
|   |-- README.md
|   |-- build_qualcomm_spne_modelconverter.sh
|   `-- qualcomm_snpe.Dockerfile
|-- include
|   `-- version.h
|-- install
|   `-- qualcomm_x86_64_linux
|       |-- scripts
|       |   `-- env_qualcomm_snpe.sh
|       |-- test
|       |   `-- test_snpe_runtime
|       `-- third_party
|           `-- snpe
|               |-- include
|               |   `-- SNPE
|               `-- lib
|-- java
|-- python
|-- release
|   |-- docs
|   `-- scripts
|       `-- env_qualcomm_snpe.sh
|-- sample
|   |-- CMakeLists.txt
|   `-- README.md
|-- src
|   |-- CMakeLists.txt
|   |-- api
|   |   |-- README.md
|   |   |-- api_cv.cpp
|   |   |-- api_nlp.cpp
|   |   `-- api_audio.cpp
|   |-- app
|   |   `-- README.md
|   |-- core
|   |   `-- README.md
|   `-- registry
|       |-- README.md
|       |-- algorithm
|       |   |-- audio
|       |   |-- cv
|       |   `-- nlp
|       `-- devices
|           |-- mtk
|           `-- qualcomm
|               |-- qnn
|               `-- snpe
|                   |-- snpe_infer.cpp
|                   |-- snpe_infer.h
|                   |-- snpe_model.cpp
|                   `-- snpe_model.h
|-- test
|   |-- CMakeLists.txt
|   `-- registry
|       |-- test_qnn_runtime.cpp
|       `-- test_snpe_runtime.cpp
|-- third_party
|   `-- qcom
|-- toolchains
|   |-- android_ndk.cmake
|   `-- x86_clang.cmake
|-- tools
|   |-- ai_tools
|   |   |-- README.md
|   |   |-- ai-tools
|   |   |   |-- __init__.py
|   |   |   |-- benchmark
|   |   |   |   `-- communication
|   |   |   |       `-- adb.py
|   |   |   |-- core
|   |   |   |   `-- pipeline.py
|   |   |   |-- infer
|   |   |   `-- modelconverter
|   |   |-- config
|   |   |   `-- snpe.json
|   |   |-- doc
|   |   `-- main.py
|   |-- dynamic2static.py
|   `-- encryption
`-- version.h.in
```